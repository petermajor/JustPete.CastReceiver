<html>

<script src="https://www.gstatic.com/cast/sdk/libs/receiver/2.0.0/cast_receiver.js"></script>
<script type="text/javascript">
    var namespace = "urn:x-cast:com.petermajor.justpete";

    var players = []

    function onChannelOpened(event)
    {
        console.log("onChannelOpened. Total number of channels: " + window.castReceiverManager.getSenders().length);
    }

    function onChannelClosed(event)
    {
        console.log("onChannelClosed. Total number of channels: " + window.castReceiverManager.getSenders().length);
        if (window.castReceiverManager.getSenders().length == 0) {
            window.close();
        }
    }

    function onMessage(event)
    {
        var message = event.data;
        var senderId = event.senderId;
        console.log('onMessage ' + JSON.stringify(event.data));

        if (message.command == 'join') {
            onJoin(senderId, message);
        }
        else if (message.command == 'guess') {
            onGuess(senderId, message);
        } else {
            console.log('Invalid message command: ' + message.command);
        }
    }

    function onJoin(senderId, message) {
        console.log('join: ' + senderId);
    }

    function onGuess(senderId, message) {
        console.log('guess: ' + message.value);
    }

    function onLoad()
    {
        console.log("document loaded");

        cast.receiver.logger.setLevelValue(cast.receiver.LoggerLevel.DEBUG);

        window.castReceiverManager = cast.receiver.CastReceiverManager.getInstance();

        window.castReceiverManager.onSenderConnected = onChannelOpened;
        window.castReceiverManager.onSenderDisconnected = onChannelClosed;

        window.customMessageBus = window.castReceiverManager.getCastMessageBus(namespace, cast.receiver.CastMessageBus.MessageType.JSON);
        window.customMessageBus.onMessage = onMessage;

        window.castReceiverManager.start();

        console.log("cast started");
    }

    window.addEventListener("load", onLoad);
</script>

<body>
    <div id="root" style="position:absolute; top:0; left:0; height:100%; width:100%; color:#FFFFFF;" />
        chromecast demo<br>
    </div>
</body>

</html>